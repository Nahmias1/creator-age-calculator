<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creator Works</title>

<style>

body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background-color: #121212;
  color: #ffffff;
  margin: 0;
  padding: 40px;
}

h1 {
  text-align: center;
  margin-bottom: 30px;
}

.container {
  max-width: 900px;
  margin: auto;
}

input {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  margin-bottom: 15px;
  background-color: #1e1e1e;
  color: white;
  border: 1px solid #333;
  border-radius: 6px;
  box-sizing: border-box;
}

.buttons {
  display: flex;
  gap: 10px;
  margin-bottom: 25px;
}

button {
  flex: 1;
  padding: 14px;
  font-size: 16px;
  background-color: #2d2d2d;
  color: white;
  border: 1px solid #444;
  border-radius: 6px;
}

button:hover {
  background-color: #3a3a3a;
}

#imageArea {
  text-align: center;
  margin-bottom: 15px;
}

#imageArea img {
  width: 160px;
  border-radius: 10px;
}

#creatorInfo {
  text-align: center;
  color: #bbb;
  margin-bottom: 30px;
}

#worksList h3 {
  margin-top: 40px;
  border-bottom: 1px solid #333;
  padding-bottom: 6px;
}

#worksList ul {
  list-style: none;
  padding: 0;
}

#worksList li {
  display: flex;
  justify-content: space-between;
  padding: 10px 0;
  border-bottom: 1px solid #1f1f1f;
}

.year { color: #888; }
.age { color: #777; }

/* MOBILE ADJUSTMENTS */
@media (max-width: 768px) {

  body {
    padding: 20px;
  }

  .buttons {
    flex-direction: column;
  }

  #worksList li {
    display: block;
  }

  .year {
    font-size: 13px;
  }

  .age {
    font-size: 13px;
  }
}

@media (max-width: 768px) {

body {
  padding: 20px;
}

.buttons {
  flex-direction: column;
}

#worksList li {
  display: block;
  padding: 16px;
  line-height: 1.4;
}

#worksList li span {
  display: block;
  margin-bottom: 4px;
}

.year {
  font-size: 13px;
  color: #888;
}

.age {
  font-size: 13px;
  color: #777;
}

}
@media (max-width: 768px) {

#worksList li {
  display: block;
  padding: 14px 0;
}

#worksList li span {
  display: block;
  margin-bottom: 4px;
}

.year {
  font-size: 13px;
  color: #888;
}

.age {
  font-size: 13px;
  color: #777;
}

}
</style>
</head>

<body>

<div class="container">

<h1>Creator Works</h1>

<input type="text" id="creatorInput" placeholder="Enter creator name">

<div class="buttons">
  <button onclick="loadWorks('ASC')">Works Ascending</button>
  <button onclick="loadWorks('DESC')">Works Descending</button>
</div>

<div id="imageArea"></div>
<div id="creatorInfo"></div>
<div id="worksList"></div>

</div>

<script>

function formatDate(timeString) {
  const clean = timeString.replace("+", "").split("T")[0];
  const parts = clean.split("-");
  const months = [
    "January","February","March","April","May","June",
    "July","August","September","October","November","December"
  ];
  return months[parseInt(parts[1]) - 1] + " " + parts[2] + ", " + parts[0];
}

async function getCreatorData(name) {
  const searchRes = await fetch(
    `https://www.wikidata.org/w/api.php?action=wbsearchentities&search=${encodeURIComponent(name)}&language=en&format=json&origin=*`
  );
  const searchData = await searchRes.json();
  if (!searchData.search.length) return null;

  const creatorId = searchData.search[0].id;

  const detailsRes = await fetch(
    `https://www.wikidata.org/wiki/Special:EntityData/${creatorId}.json`
  );
  const details = await detailsRes.json();
  const entity = details.entities[creatorId];

  return { creatorId, entity };
}

async function loadWorks(order) {

  const creatorName = document.getElementById("creatorInput").value.trim();
  const worksDiv = document.getElementById("worksList");
  const imageArea = document.getElementById("imageArea");
  const creatorInfo = document.getElementById("creatorInfo");

  worksDiv.innerHTML = "";
  imageArea.innerHTML = "";
  creatorInfo.innerHTML = "";

  if (!creatorName) {
    worksDiv.innerHTML = "Enter a creator first.";
    return;
  }

  try {

    const creatorData = await getCreatorData(creatorName);
    if (!creatorData) {
      worksDiv.innerHTML = "Creator not found.";
      return;
    }

    const { creatorId, entity } = creatorData;

    const birth = entity.claims.P569?.[0]?.mainsnak?.datavalue?.value?.time;
    if (!birth) {
      worksDiv.innerHTML = "Birth date not available.";
      return;
    }

    const death = entity.claims.P570?.[0]?.mainsnak?.datavalue?.value?.time;

    const birthYear = parseInt(birth.substring(1,5));
    const deathYear = death ? parseInt(death.substring(1,5)) : null;

    const creatorImage = entity.claims.P18?.[0]?.mainsnak?.datavalue?.value;

    if (creatorImage) {
      const img = document.createElement("img");
      img.src = `https://commons.wikimedia.org/wiki/Special:FilePath/${creatorImage.replace(/ /g,"_")}`;
      imageArea.appendChild(img);
    }

    // Fetch English Wikipedia page for creator
const wikiQuery = `
  SELECT ?article WHERE {
    ?article schema:about wd:${creatorId} ;
             schema:isPartOf <https://en.wikipedia.org/> .
  }
  LIMIT 1
`;

const wikiResponse = await fetch(
  "https://query.wikidata.org/sparql?format=json&query=" +
  encodeURIComponent(wikiQuery)
);

const wikiData = await wikiResponse.json();

const creatorWiki =
  wikiData.results.bindings.length
    ? wikiData.results.bindings[0].article.value
    : null;

creatorInfo.innerHTML =
  `<div>
     ${creatorWiki
        ? `<a href="${creatorWiki}" target="_blank" style="color:#fff; text-decoration:none; font-weight:500;">${creatorName}</a>`
        : creatorName
     }
   </div>
   <div><strong>Born:</strong> ${formatDate(birth)}</div>`;

    async function runQuery(property) {

        const query = `
  SELECT DISTINCT ?work ?workLabel ?date ?article WHERE {

    ?work wdt:${property} wd:${creatorId}.

    OPTIONAL { ?work wdt:P577|wdt:P571 ?date. }

    OPTIONAL {
      ?article schema:about ?work ;
               schema:isPartOf <https://en.wikipedia.org/> .
    }

    SERVICE wikibase:label { bd:serviceParam wikibase:language "en". }
  }
`;

      const response = await fetch(
        "https://query.wikidata.org/sparql?format=json&query=" +
        encodeURIComponent(query)
      );

      const data = await response.json();

      const map = new Map();

      data.results.bindings.forEach(item => {

        if (!item.workLabel) return;

        const title = item.workLabel.value;
        if (title.startsWith("Q")) return;

        const year = item.date
          ? parseInt(item.date.value.substring(0,4))
          : null;

        const wiki = item.article ? item.article.value : null;

        if (!map.has(title)) {
         map.set(title, { title, year, wiki });
        }

      });

      let works = Array.from(map.values());

      works.sort((a,b) => {
        const yearA = a.year || 9999;
        const yearB = b.year || 9999;
        return order === "ASC" ? yearA - yearB : yearB - yearA;
      });

      return works;
    }

    const directed = await runQuery("P57");
    const acted = await runQuery("P161");
    const books = await runQuery("P50");

    function buildSection(title, works) {
      if (!works.length) return "";

      let html = `<h3>${title}</h3><ul>`;

      works.forEach(w => {

        let ageDisplay;

        if (!w.year) ageDisplay = "unknown";
        else if (deathYear && w.year > deathYear) ageDisplay = "posthumous";
        else ageDisplay = w.year - birthYear;

        html += `
          <li>
            <span class="year">${w.year || "â€”"}</span>
            <span>
  ${w.wiki
    ? `<a href="${w.wiki}" target="_blank" style="color:#fff; text-decoration:none;">${w.title}</a>`
    : w.title
  }
</span>
            <span class="age">${ageDisplay}</span>
          </li>`;
      });

      html += "</ul>";
      return html;
    }

    worksDiv.innerHTML =
      buildSection("Directed", directed) +
      buildSection("Acted", acted) +
      buildSection("Books", books);

  } catch (error) {
    worksDiv.innerHTML = "Error loading works.";
    console.error(error);
  }
}

</script>

</body>
</html>
